     1                                  extern printf       
     2                                  extern scanf 
     3                                  extern fgets
     4                                  extern stdin
     5                                  extern strlen
     6                                  global average
     7                                  
     8                                  max_name_size equ 64
     9                                  max_title_size equ 64
    10                                  
    11                                  segment .data
    12 00000000 506C6561736520656E-         get_name        db  "Please enter your first and last names:", 0
    12 00000009 74657220796F757220-
    12 00000012 666972737420616E64-
    12 0000001B 206C617374206E616D-
    12 00000024 65733A00           
    13 00000028 506C6561736520656E-         get_title       db  "Please enter your title such as Lieutenant, Chief, Mr, Ms, Influencer, Chairman, Freshman, Foreman, Project Leader, etc:", 0 
    13 00000031 74657220796F757220-
    13 0000003A 7469746C6520737563-
    13 00000043 68206173204C696575-
    13 0000004C 74656E616E742C2043-
    13 00000055 686965662C204D722C-
    13 0000005E 204D732C20496E666C-
    13 00000067 75656E6365722C2043-
    13 00000070 686169726D616E2C20-
    13 00000079 46726573686D616E2C-
    13 00000082 20466F72656D616E2C-
    13 0000008B 2050726F6A65637420-
    13 00000094 4C65616465722C2065-
    13 0000009D 74633A00           
    14 000000A1 5468616E6B20796F75-         thank           db  "Thank you %s %s ", 10, 10, 0
    14 000000AA 202573202573200A0A-
    14 000000B3 00                 
    15                                  
    16 000000B4 456E74657220746865-         fulltosan       db  "Enter the number of miles traveled from Fullerton to Santa Ana: ", 0
    16 000000BD 206E756D626572206F-
    16 000000C6 66206D696C65732074-
    16 000000CF 726176656C65642066-
    16 000000D8 726F6D2046756C6C65-
    16 000000E1 72746F6E20746F2053-
    16 000000EA 616E746120416E613A-
    16 000000F3 2000               
    17 000000F5 456E74657220796F75-         speed1          db  "Enter your average speed during that leg of the trip: ", 10, 0
    17 000000FE 722061766572616765-
    17 00000107 207370656564206475-
    17 00000110 72696E672074686174-
    17 00000119 206C6567206F662074-
    17 00000122 686520747269703A20-
    17 0000012B 0A00               
    18                                  
    19 0000012D 456E74657220746865-         santolong       db  "Enter the number of miles traveled from Santa Ana to Long Beach: ", 0
    19 00000136 206E756D626572206F-
    19 0000013F 66206D696C65732074-
    19 00000148 726176656C65642066-
    19 00000151 726F6D2053616E7461-
    19 0000015A 20416E6120746F204C-
    19 00000163 6F6E67204265616368-
    19 0000016C 3A2000             
    20 0000016F 456E74657220796F75-         speed2          db  "Enter your average speed during that leg of the trip: ", 10, 0
    20 00000178 722061766572616765-
    20 00000181 207370656564206475-
    20 0000018A 72696E672074686174-
    20 00000193 206C6567206F662074-
    20 0000019C 686520747269703A20-
    20 000001A5 0A00               
    21                                  
    22 000001A7 456E74657220746865-         longtofull      db  "Enter the number of miles traveled from Long Beach to Fullerton: ", 0
    22 000001B0 206E756D626572206F-
    22 000001B9 66206D696C65732074-
    22 000001C2 726176656C65642066-
    22 000001CB 726F6D204C6F6E6720-
    22 000001D4 426561636820746F20-
    22 000001DD 46756C6C6572746F6E-
    22 000001E6 3A2000             
    23 000001E9 456E74657220796F75-         speed3          db  "Enter your average speed during that leg of the trip: ", 10, 0
    23 000001F2 722061766572616765-
    23 000001FB 207370656564206475-
    23 00000204 72696E672074686174-
    23 0000020D 206C6567206F662074-
    23 00000216 686520747269703A20-
    23 0000021F 0A00               
    24                                      
    25 00000221 54686520696E707574-         proccessed      db  "The inputted data are being processed", 0
    25 0000022A 746564206461746120-
    25 00000233 617265206265696E67-
    25 0000023C 2070726F6365737365-
    25 00000245 6400               
    26                                      
    27 00000247 54686520746F74616C-         totaldistance   db  "The total distance traveled is %lf miles.", 0
    27 00000250 2064697374616E6365-
    27 00000259 2074726176656C6564-
    27 00000262 20697320256C66206D-
    27 0000026B 696C65732E00       
    28 00000271 5468652074696D6520-         time            db  "The time of the trip is $lf hours", 0
    28 0000027A 6F6620746865207472-
    28 00000283 697020697320246C66-
    28 0000028C 20686F75727300     
    29 00000293 546865206176657261-         averagespeed    db  "The average speed during this trip is $lf mph.", 0
    29 0000029C 676520737065656420-
    29 000002A5 647572696E67207468-
    29 000002AE 697320747269702069-
    29 000002B7 7320246C66206D7068-
    29 000002C0 2E00               
    30                                  
    31 000002C2 257300                      string_format   db "%s", 0
    32 000002C5 256C6600                    double_format   db "%lf", 0
    33                                  
    34                                  segment .bss
    35                                      align 64
    36 00000000 <res 00000384>              backup resb 900
    37 00000384 <res 00000040>              name resb max_name_size
    38 000003C4 <res 00000040>              title resb max_title_size
    39                                  
    40                                  segment .text
    41                                  
    42                                  average:
    43                                  ; Back up all the GPRs
    44 00000000 55                          push    rbp
    45 00000001 4889E5                      mov     rbp, rsp
    46 00000004 53                          push    rbx
    47 00000005 51                          push    rcx
    48 00000006 52                          push    rdx
    49 00000007 56                          push    rsi
    50 00000008 57                          push    rdi
    51 00000009 4150                        push    r8
    52 0000000B 4151                        push    r9
    53 0000000D 4152                        push    r10
    54 0000000F 4153                        push    r11
    55 00000011 4154                        push    r12
    56 00000013 4155                        push    r13
    57 00000015 4156                        push    r14
    58 00000017 4157                        push    r15
    59 00000019 9C                          pushf
    60                                  
    61                                  
    62                                  ; Ask Name
    63 0000001A B800000000                  mov qword   rax, 0
    64 0000001F 48BF-                       mov         rdi, string_format
    64 00000021 [C202000000000000] 
    65 00000029 48BE-                       mov         rsi, get_name
    65 0000002B [0000000000000000] 
    66 00000033 E8(00000000)                call        printf 
    67                                  
    68                                  
    69                                  ; Obtain name
    70 00000038 B800000000                  mov qword rax, 0
    71 0000003D 48BF-                       mov rdi, name
    71 0000003F [8403000000000000] 
    72 00000047 BE40000000                  mov rsi, max_name_size
    73 0000004C 488B1425[00000000]          mov rdx, [stdin]
    74 00000054 E8(00000000)                call fgets
    75                                  
    76                                  ; compute the length of the name and remove the newline
    77 00000059 B800000000                  mov qword rax, 0
    78 0000005E 48BF-                       mov rdi, name
    78 00000060 [8403000000000000] 
    79 00000068 E8(00000000)                call strlen
    80 0000006D C680[83030000]00            mov byte [name + rax - 1],byte 0
    81                                  
    82                                  ; Ask title
    83 00000074 B800000000                  mov qword   rax, 0
    84 00000079 48BF-                       mov         rdi, string_format
    84 0000007B [C202000000000000] 
    85 00000083 48BE-                       mov         rsi, get_title
    85 00000085 [2800000000000000] 
    86 0000008D E8(00000000)                call        printf 
    87                                  
    88                                  ; Obtain title
    89 00000092 B800000000                  mov qword rax, 0
    90 00000097 48BF-                       mov rdi, title
    90 00000099 [C403000000000000] 
    91 000000A1 BE40000000                  mov rsi, max_title_size
    92 000000A6 488B1425[00000000]          mov rdx, [stdin]
    93 000000AE E8(00000000)                call fgets
    94                                  
    95                                  ; compute the length of the name and remove the newline
    96 000000B3 B800000000                  mov qword rax, 0
    97 000000B8 48BF-                       mov rdi, title
    97 000000BA [C403000000000000] 
    98 000000C2 E8(00000000)                call strlen
    99 000000C7 C680[C3030000]00            mov byte [title + rax - 1],byte 0
   100                                  
   101                                  ;print thank message
   102 000000CE B800000000                  mov qword rax, 0
   103 000000D3 48BF-                       mov rdi, thank
   103 000000D5 [A100000000000000] 
   104 000000DD 48BE-                       mov rsi, title
   104 000000DF [C403000000000000] 
   105 000000E7 E8(00000000)                call printf
   106                                  
   107                                  ; Trip one
   108 000000EC B800000000                  mov qword   rax, 0
   109 000000F1 48BF-                       mov         rdi, string_format
   109 000000F3 [C202000000000000] 
   110 000000FB 48BE-                       mov         rsi, fulltosan
   110 000000FD [B400000000000000] 
   111 00000105 E8(00000000)                call        printf
   112                                  
   113                                  ; Obtain trip one speed
   114 0000010A B800000000                  mov qword   rax, 0
   115 0000010F 48BF-                       mov         rdi, double_format
   115 00000111 [C502000000000000] 
   116 00000119 4889E6                      mov         rsi, rsp
   117 0000011C E8(00000000)                call        scanf
   118 00000121 F2440F100424                movsd       xmm8, [rsp]
   119 00000127 F2440F10E0                  movsd       xmm12, xmm0     ;xmm12 cotain fulltosan miles
   120                                  
   121                                  ; Trip one average
   122 0000012C B800000000                  mov qword   rax, 0
   123 00000131 48BF-                       mov         rdi, string_format
   123 00000133 [C202000000000000] 
   124 0000013B 48BE-                       mov         rsi, speed1
   124 0000013D [F500000000000000] 
   125 00000145 E8(00000000)                call        printf
   126                                  
   127                                  ; Obtain trip one speed
   128 0000014A B800000000                  mov qword   rax, 0
   129 0000014F 48BF-                       mov         rdi, double_format
   129 00000151 [C502000000000000] 
   130 00000159 4889E6                      mov         rsi, rsp
   131 0000015C E8(00000000)                call        scanf
   132 00000161 F2440F100424                movsd       xmm8, [rsp]
   133 00000167 F2440F10E8                  movsd       xmm13, xmm0     ;xmm13 cotain fulltosan speed
   134                                  
   135                                  ; Trip two
   136 0000016C B800000000                  mov qword   rax, 0
   137 00000171 48BF-                       mov         rdi, string_format
   137 00000173 [C202000000000000] 
   138 0000017B 48BE-                       mov         rsi, santolong
   138 0000017D [2D01000000000000] 
   139 00000185 E8(00000000)                call        printf
   140                                  
   141                                  ; Obtain trip one speed
   142 0000018A B800000000                  mov qword   rax, 0
   143 0000018F 48BF-                       mov         rdi, double_format
   143 00000191 [C502000000000000] 
   144 00000199 4889E6                      mov         rsi, rsp
   145 0000019C E8(00000000)                call        scanf
   146 000001A1 F2440F100424                movsd       xmm8, [rsp]
   147 000001A7 F2440F10F0                  movsd       xmm14, xmm0     ;xmm14 cotain santolong miles
   148                                  
   149                                  ; Trip two average
   150 000001AC B800000000                  mov qword   rax, 0
   151 000001B1 48BF-                       mov         rdi, string_format
   151 000001B3 [C202000000000000] 
   152 000001BB 48BE-                       mov         rsi, speed2
   152 000001BD [6F01000000000000] 
   153 000001C5 E8(00000000)                call        printf
   154                                  
   155                                  ; Obtain trip two speed
   156 000001CA B800000000                  mov qword   rax, 0
   157 000001CF 48BF-                       mov         rdi, double_format
   157 000001D1 [C502000000000000] 
   158 000001D9 4889E6                      mov         rsi, rsp
   159 000001DC E8(00000000)                call        scanf
   160 000001E1 F2440F100424                movsd       xmm8, [rsp]
   161 000001E7 F2440F10F8                  movsd       xmm15, xmm0     ;xmm15 cotain santolong speed
   162                                  
   163                                  ; Trip three
   164 000001EC B800000000                  mov qword   rax, 0
   165 000001F1 48BF-                       mov         rdi, string_format
   165 000001F3 [C202000000000000] 
   166 000001FB 48BE-                       mov         rsi, longtofull
   166 000001FD [A701000000000000] 
   167 00000205 E8(00000000)                call        printf
   168                                  
   169                                  ; Obtain trip three speed
   170 0000020A B800000000                  mov qword   rax, 0
   171 0000020F 48BF-                       mov         rdi, double_format
   171 00000211 [C502000000000000] 
   172 00000219 4889E6                      mov         rsi, rsp
   173 0000021C E8(00000000)                call        scanf
   174 00000221 F2440F100424                movsd       xmm8, [rsp]
   175 00000227 F2440F10C8                  movsd       xmm9, xmm0     ;xmm9 cotain longtofull miles
   176                                  
   177                                  ; Trip three average
   178 0000022C B800000000                  mov qword   rax, 0
   179 00000231 48BF-                       mov         rdi, string_format
   179 00000233 [C202000000000000] 
   180 0000023B 48BE-                       mov         rsi, speed3
   180 0000023D [E901000000000000] 
   181 00000245 E8(00000000)                call        printf
   182                                  
   183                                  ; Obtain trip three speed
   184 0000024A B800000000                  mov qword   rax, 0
   185 0000024F 48BF-                       mov         rdi, double_format
   185 00000251 [C502000000000000] 
   186 00000259 4889E6                      mov         rsi, rsp
   187 0000025C E8(00000000)                call        scanf
   188 00000261 F2440F100424                movsd       xmm8, [rsp]
   189 00000267 F2440F10D0                  movsd       xmm10, xmm0     ;xmm10 cotain longtofull speed
   190                                  
   191 0000026C EB00                    jmp exit
   192                                  
   193                                  exit:
   194                                  ; Restoring the original value to the GPRs (jmp exit to exit this .asm file)
   195                                      
   196 0000026E 9D                          popf
   197 0000026F 415F                        pop        r15
   198 00000271 415E                        pop        r14
   199 00000273 415D                        pop        r13
   200 00000275 415C                        pop        r12
   201 00000277 415B                        pop        r11
   202 00000279 415A                        pop        r10
   203 0000027B 4159                        pop        r9
   204 0000027D 4158                        pop        r8
   205 0000027F 5F                          pop        rdi
   206 00000280 5E                          pop        rsi
   207 00000281 5A                          pop        rdx
   208 00000282 59                          pop        rcx
   209 00000283 5B                          pop        rbx
   210 00000284 5D                          pop        rbp
   211                                  
   212 00000285 C3                          ret
